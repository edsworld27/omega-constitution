<?xml version="1.0" encoding="UTF-8"?>
<!--
  AI_PROTOCOL.xml — AI-to-AI Communication Protocol

  CREATED BY: Omega Claw installation
  PURPOSE: Defines how Claude agents communicate via files

  This file gets copied to Constitution V10/CONSTITUTION/ during install.
-->

<ai_protocol version="1.0">

  <!-- ═══════════════════════════════════════════════════════════════ -->
  <!--                     COMMUNICATION LAYER                          -->
  <!-- ═══════════════════════════════════════════════════════════════ -->

  <communication>
    <description>
      When Omega Claw is active, Claude agents communicate through files.
      This enables remote control via Telegram and autonomous operation.
    </description>

    <directories>
      <inbox path="USER SPACE/dev-work/hive/ai_inbox/">
        Jobs, messages, and requests FROM users/systems TO Claude
      </inbox>
      <outbox path="USER SPACE/dev-work/hive/ai_outbox/">
        Reports, responses, and outputs FROM Claude TO users/systems
      </outbox>
      <state path="USER SPACE/dev-work/hive/ai_state/">
        Current status, active jobs, agent state files
      </state>
    </directories>
  </communication>

  <!-- ═══════════════════════════════════════════════════════════════ -->
  <!--                     STARTUP PROTOCOL                             -->
  <!-- ═══════════════════════════════════════════════════════════════ -->

  <on_startup>
    <step order="1">
      Check if ai_inbox/ has any PENDING files
    </step>
    <step order="2">
      If yes, read the oldest PENDING file first (FIFO queue)
    </step>
    <step order="3">
      Update ai_state/AGENT_STATUS.md with current state
    </step>
    <step order="4">
      Begin working on the job, writing progress to ai_outbox/
    </step>
  </on_startup>

  <!-- ═══════════════════════════════════════════════════════════════ -->
  <!--                     FILE FORMATS                                 -->
  <!-- ═══════════════════════════════════════════════════════════════ -->

  <file_formats>

    <!-- INBOX: Jobs/requests coming in -->
    <inbox_format>
      <filename>JOB-{timestamp}-{short_id}.md</filename>
      <example>
        ```markdown
        # Job: Build Landing Page

        **ID**: JOB-20260226-a1b2
        **Status**: PENDING
        **Priority**: HIGH
        **From**: Telegram (user: founder)
        **Received**: 2026-02-26T10:30:00Z

        ## Request
        Build a landing page for my SaaS product. Use the website kit.

        ## Context
        - Kit: website
        - Mode: speed
        ```
      </example>
    </inbox_format>

    <!-- OUTBOX: Reports/responses going out -->
    <outbox_format>
      <filename>REPORT-{job_id}-{timestamp}.md</filename>
      <example>
        ```markdown
        # Report: JOB-20260226-a1b2

        **Time**: 2026-02-26T10:45:00Z
        **Phase**: PRE-PRODUCTION
        **Status**: COMPLETE

        ## Summary
        Completed project scaffolding and initial structure.

        ## Files Created
        - project/index.html
        - project/styles.css
        - project/script.js

        ## Next
        Moving to PRODUCTION phase - building components.
        ```
      </example>
    </outbox_format>

    <!-- STATE: Agent status -->
    <state_format>
      <filename>AGENT_STATUS.md</filename>
      <example>
        ```markdown
        # Agent Status

        **Last Updated**: 2026-02-26T10:45:00Z
        **State**: WORKING
        **Current Job**: JOB-20260226-a1b2
        **Phase**: PRE-PRODUCTION

        ## Queue
        - JOB-20260226-a1b2 (IN_PROGRESS)
        - JOB-20260226-c3d4 (PENDING)
        ```
      </example>
    </state_format>

    <!-- BLOCKER: When Claude needs user input -->
    <blocker_format>
      <filename>BLOCKED-{job_id}.md</filename>
      <example>
        ```markdown
        # Blocked: JOB-20260226-a1b2

        **Time**: 2026-02-26T11:00:00Z
        **Reason**: NEED_INPUT

        ## What I Need
        API key for Stripe integration.

        ## Why
        Cannot proceed with payment setup without credentials.

        ## Options
        1. Provide Stripe API key
        2. Skip payment integration for now
        3. Use test/sandbox mode
        ```
      </example>
    </blocker_format>

    <!-- ANSWER: User response to blocker -->
    <answer_format>
      <filename>ANSWER-{job_id}.md</filename>
      <example>
        ```markdown
        # Answer: JOB-20260226-a1b2

        **Time**: 2026-02-26T11:05:00Z
        **From**: User via Telegram

        ## Response
        Use test mode for now. Here's the test key: sk_test_xxx
        ```
      </example>
    </answer_format>

  </file_formats>

  <!-- ═══════════════════════════════════════════════════════════════ -->
  <!--                     POLLING BEHAVIOR                             -->
  <!-- ═══════════════════════════════════════════════════════════════ -->

  <polling>
    <description>
      Omega Claw Python process polls these directories and bridges to Telegram.
    </description>

    <watches>
      <watch dir="ai_outbox/" action="send_to_telegram">
        New REPORT files get sent to user via Telegram
      </watch>
      <watch dir="ai_state/" action="update_status">
        AGENT_STATUS.md changes update bot status
      </watch>
      <watch dir="blockers/" action="ask_user">
        BLOCKED files trigger Telegram questions to user
      </watch>
    </watches>

    <triggers>
      <trigger event="telegram_message" action="write_to_inbox">
        User messages create JOB files in ai_inbox/
      </trigger>
      <trigger event="user_answer" action="write_answer">
        User responses to blockers create ANSWER files
      </trigger>
    </triggers>
  </polling>

  <!-- ═══════════════════════════════════════════════════════════════ -->
  <!--                     INTEGRATION                                  -->
  <!-- ═══════════════════════════════════════════════════════════════ -->

  <integration>
    <instructor_hook>
      When INSTRUCTOR.xml loads, check for AI_PROTOCOL.xml.
      If present, Omega Claw is installed - follow communication protocol.
    </instructor_hook>

    <activation_check>
      <file>CONSTITUTION/AI_PROTOCOL.xml</file>
      <if_exists>Omega Claw is installed - check ai_inbox on startup</if_exists>
      <if_missing>Standard mode - no autonomous features</if_missing>
    </activation_check>
  </integration>

</ai_protocol>
