# CHANGELOG - Quality & DX Refinements

## v14.5 (2026-02-28)

### Summary
Extended error taxonomy, added lock timeout escalation strategy, implemented context cascade pruning, and created CLI installer prototype.

---

### 1. Extended Error Taxonomy (QUALITY.xml)

Added two new error categories for multi-agent and context scenarios:

| Code | Name | Max Attempts | Purpose |
|------|------|--------------|---------|
| **E8** | Coordination Error | 3 | Lock conflicts, job overlap, race conditions |
| **E9** | Context Error | 2 | SESSION_CONTEXT.md overflow, stale context |

**E8 Repair Protocol:**
1. Check hive/locks/ for active locks
2. Run hive_locker.py status
3. If stale: cleanup and retry
4. Wait 30s between retries (max 3)
5. If blocked: escalate to Master Orchestrator

**E9 Repair Protocol:**
1. Check SESSION_CONTEXT.md size (warn >50KB, critical >100KB)
2. Identify stale sections from completed phases
3. Archive to 06_vault/context_archive/
4. Prune to active phase only
5. Validate current checkpoint is clear

---

### 2. Lock Timeout Escalation Strategy (INSTRUCTOR.xml)

Added 5-tier escalation strategy for lock conflicts:

| Tier | Name | Duration | Action |
|------|------|----------|--------|
| 1 | Immediate Check | 0-30s | Check if stale, cleanup |
| 2 | Wait and Retry | 30-120s | Wait 30s, retry (3x) |
| 3 | Alternative Path | 2-5min | Work on unlocked files |
| 4 | Coordination Request | 5-10min | Write blocker file, notify |
| 5 | Human Escalation | >10min | STOP REPORT, await decision |

**Timeout Thresholds:**
- File lock: 300s (5 minutes)
- Git push lock: 60s (1 minute)
- Stale heartbeat: 120s (2 minutes)
- Escalation to human: 600s (10 minutes)

---

### 3. Context Cascade Pruning (INSTRUCTOR.xml)

Added protocol for managing SESSION_CONTEXT.md growth:

**Thresholds:**
| Level | Lines | KB | Action |
|-------|-------|-----|--------|
| Warning | 500 | 25 | Check for pruning opportunity |
| Action | 1000 | 50 | Prune before next checkpoint |
| Critical | 2000 | 100 | HALT and force prune |

**Pruning Protocol:**
1. Measure current size
2. Identify stale sections (completed phases, incorporated seeds)
3. Archive to 06_vault/context_archive/[date]-[phase].md
4. Compress active sections (remove "how", keep "what")
5. Restructure to target <100 lines
6. Validate no broken references

**Auto-Prune Triggers:**
- Phase completion (CP-7)
- Session start if threshold exceeded
- Mode transition (PRE-PRODUCTION â†’ PRODUCTION)
- On E9 classification

---

### 4. CLI Installer Prototype (omega_installer.py)

New tool for kit installation from command line:

```bash
# List available kits
python omega_installer.py list

# Get kit details
python omega_installer.py info website

# Install a kit
python omega_installer.py install website

# List installed kits
python omega_installer.py installed

# Remove a kit
python omega_installer.py uninstall website
```

**Features:**
- Scans omega-store/kits/ for available kits
- Copies to plug-and-play/ directory
- Creates installation manifest (.omega_install.json)
- Supports --json output for scripting
- Configurable store and project paths

---

### Files Modified

| File | Change |
|------|--------|
| `CONSTITUTION/QUALITY.xml` | Added E8 + E9 error categories |
| `CONSTITUTION/INSTRUCTOR.xml` | Added lock_timeout_escalation + context_cascade_pruning |

### Files Created

| File | Purpose |
|------|---------|
| `CONSTITUTION/python/omega_installer.py` | CLI kit installer (~300 lines) |

---

### Testing

```bash
# Test error categories
# E8 and E9 are now available in classification

# Test CLI installer
cd CONSTITUTION/python
python3 omega_installer.py list       # Shows 1 kit (website)
python3 omega_installer.py info website  # Shows kit details
```

---

*Logged per META_DEV_MODE.xml protocol.*
